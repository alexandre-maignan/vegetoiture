<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilan hydrique toitures végétalisées - Paris</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    body {
      display: flex;
      flex-direction: row;
    }
    #map {
      flex: 1;
      height: 100%;
      position: relative;
    }
    .info {
      width: 45vw; /* 1/3 environ */
      height: 100%;
      background: #f8f9fa; /* fond clair */
      padding: 20px;
      box-shadow: -2px 0 8px rgba(0,0,0,0.4);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border-left: 2px solid #dee2e6;
      overflow-y: auto;
      box-sizing: border-box;
      border-radius: 0 10px 10px 0;
    }
    .info h2 {
      margin-top: 0;
      margin-bottom:10px;
      font-size: 2.1em;
      color: #28a745;
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .info label {
      font-weight: 600;
      color: #495057;
    }
    .info select {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 15px;
      padding: 6px 8px;
      border: 1px solid #ced4da;
      border-radius: 5px;
      font-size: 0.95em;
      background: #ffffff;
      color: #495057;
    }
    #result {
      line-height: 1.5;
      color: #495057;
      margin-bottom:  40px;
    }
    #result b {
      color: #212529;
    }


    #toitureImage {
      width: 100%;
      border-radius: 8px;
      margin-top: 10px;
      margin-bottom: 30px;

    }













.section-toiture h3 {
  margin-top: 0;
  font-size: 1.2em;
  color: #28a745;
}

.section-toiture p {
  margin: 0;
}



h3 {
  margin-top: 0;
  font-size: 1.5em;
  color: #28a745;
}




#sectionExtensive {
  line-height: 1.2; /* réduit l'espacement entre les lignes (par défaut souvent ~1.5) */
  margin-top: 15px;

}
#sectionintensive {
  line-height: 1.2; /* réduit l'espacement entre les lignes (par défaut souvent ~1.5) */
  margin-top: 15px;
}



  </style>
</head>
<body>

<div id="map"></div>
<div class="info" id="info">
  <h2>Evaluez votre projet de toiture végétale</h2>
  <label for="typeToiture"><b>Type de toiture végétalisée :</b></label>
  <select id="typeToiture">
    <option value="extensive" >Extensive</option>
    <option value="intensive" selected>Intensive</option>
  </select>
  <img id="toitureImage" src="" alt="Image de toiture">
  <h3>Bilan hydrique de la toiture</h3>
  <div id="result">Dessinez un polygone pour calculer le bilan hydrique.</div>


<div id="sectionExtensive">
  <h3>Toiture végétalisée extensive</h3>
  <p><b>Poids :</b> léger, environ 60 à 150 kg/m².</p>
  <p><b>Entretien :</b> faible à très faible.</p>
  <p><b>Type de végétation :</b> plantes résistantes, souvent sedums, mousses, graminées, qui demandent peu de nutriments et peuvent survivre avec la pluie.</p>
  <p><b>Accessibilité :</b> rarement piétonne, usage limité.</p>

  <p><b>Objectif principal :</b></p>
  <ul>
    <li>Isolation thermique et acoustique</li>
    <li>Gestion des eaux pluviales</li>
    <li>Amélioration de la biodiversité</li>
    <li>Effet esthétique discret</li>
  </ul>

  <p><b>Avantages :</b></p>
  <ul>
    <li>Léger, facile à installer</li>
    <li>Coût relativement faible</li>
  </ul>

  <p><b>Inconvénients :</b></p>
  <ul>
    <li>Végétation moins variée</li>
    <li>Non adaptée aux espaces de loisirs</li>
  </ul>
</div>

<div id="sectionIntensive" >
  <h3>Toiture végétalisée intensive</h3>
  <p><b>Poids :</b> lourd, environ 200 à 500 kg/m² (peut nécessiter un renforcement de la structure).</p>
  <p><b>Entretien :</b> régulier (arrosage, désherbage, taille).</p>
  <p><b>Type de végétation :</b> très variée : arbustes, petits arbres, pelouses, potagers.</p>
  <p><b>Accessibilité :</b> généralement piétonne et aménageable pour des jardins ou terrasses.</p>

  <p><b>Objectif principal :</b></p>
  <ul>
    <li>Créer un espace vert utilisable</li>
    <li>Isolation thermique et acoustique plus performante</li>
    <li>Gestion des eaux pluviales</li>
  </ul>

  <p><b>Avantages :</b></p>
  <ul>
    <li>Grande biodiversité et esthétisme</li>
    <li>Possibilité d’aménagements fonctionnels</li>
  </ul>

  <p><b>Inconvénients :</b></p>
  <ul>
    <li>Poids important → nécessite renfort de structure</li>
    <li>Coût et entretien élevés</li>
  </ul>

</div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
const map = L.map('map').setView([48.8566, 2.3522], 16);

// Fond satellite Esri
const tiles = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics',
    maxZoom: 20
}).addTo(map);

// Filtre uniquement sur les tuiles
tiles.getContainer().style.filter = 'brightness(90%) contrast(80%) saturate(90%)';

// FeatureGroup pour polygones
const drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

let dernierPolygone = null;














// Initialisation du contrôle de dessin : pas de boutons d'édition au départ
let drawControl = new L.Control.Draw({
  edit: false,  // désactive les boutons de modification
  draw: {
    polygon: {
      allowIntersection: false,
      showArea: true,
      shapeOptions: {
        color: 'red',
        weight: 3,
        opacity: 0.9,
        fillColor: 'red',
        fillOpacity: 0.4,
        dashArray: '4,4'
      },
      metric: true,
      repeatMode: false
    },
    polyline: false,
    rectangle: false,
    circle: false,
    marker: false,
    circlemarker: false
  }
});
map.addControl(drawControl);

// Après création du premier polygone, on remplace le contrôle par un nouveau incluant l'édition
map.on(L.Draw.Event.CREATED, function (e) {
  const layer = e.layer;
  drawnItems.addLayer(layer);
  dernierPolygone = layer.toGeoJSON();
  afficherBilanHydrique();

  // Supprime l’ancien contrôle
  map.removeControl(drawControl);

  // Crée un nouveau contrôle avec l'édition activée
  drawControl = new L.Control.Draw({
    edit: { featureGroup: drawnItems }, // maintenant modification et suppression possibles
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
        shapeOptions: {
          color: 'red',
          weight: 3,
          opacity: 0.9,
          fillColor: 'red',
          fillOpacity: 0.4,
          dashArray: '4,4'
        },
        metric: true,
        repeatMode: false
      },
      polyline: false,
      rectangle: false,
      circle: false,
      marker: false,
      circlemarker: false
    }
  });
  map.addControl(drawControl);
});


















// Calcul bilan hydrique
function calculerBilanParis(polygonGeoJSON, typeToiture='extensive') {
  const area = turf.area(polygonGeoJSON);
  const P = 634;
  const ETp = 890.5;

  let Cr = 0.25, Kc = 0.6;
  if (typeToiture === 'intensive') { Cr = 0.5; Kc = 0.9; }

  const V_pluie = P * area * 1e-3;
  const V_retenu = P * Cr * area * 1e-3;
  const ET = ETp * Kc * area * 1e-3;
  const V_ruiss = Math.max(V_pluie - V_retenu - ET, 0);

  return { area, V_pluie, V_retenu, ET, V_ruiss };
}

// Fonction pour afficher le bilan et l'image
function afficherBilanHydrique() {
  const typeToiture = document.getElementById('typeToiture').value;

  if (dernierPolygone) {
    const bilan = calculerBilanParis(dernierPolygone, typeToiture);
    document.getElementById('result').innerHTML =
      `<b>Type de toiture :</b> ${typeToiture}<br>` +
      `<b>Surface :</b> ${bilan.area.toFixed(1)} m²<br>` +
      `<b>Volume total de pluie :</b> ${bilan.V_pluie.toFixed(2)} m³/an<br>` +
      `<b>Volume retenu :</b> ${bilan.V_retenu.toFixed(2)} m³/an<br>` +
      `<b>Évapotranspiration :</b> ${bilan.ET.toFixed(2)} m³/an<br>` +
      `<b>Volume ruisselé :</b> ${bilan.V_ruiss.toFixed(2)} m³/an`;
  }

  // Affichage de l'image selon le type de toiture
  const img = document.getElementById('toitureImage');
  if(typeToiture === 'extensive') {
    img.src = 'https://www.toit-vegetalise.fr/wp-content/uploads/2024/11/TOUNDRA-TOITURE-VEGETALISE-3.jpg'; // URL toiture extensive
  } else if(typeToiture === 'intensive') {
    img.src = 'https://www.snpn.com/wp-content/uploads/2022/12/photo_hor_RESTREINT-CLN_toit-vegetal-Paris_MBarra.jpg'; // URL toiture intensive
  }
  img.style.display = 'block';


    // Affichage des sections spécifiques
  document.getElementById('sectionExtensive').style.display = typeToiture === 'extensive' ? 'block' : 'none';
  document.getElementById('sectionIntensive').style.display = typeToiture === 'intensive' ? 'block' : 'none';

}

// Initialisation de l'image dès le chargement
window.addEventListener('DOMContentLoaded', afficherBilanHydrique);

// Création polygone
map.on(L.Draw.Event.CREATED, function (e) {
  const layer = e.layer;
  drawnItems.addLayer(layer);
  dernierPolygone = layer.toGeoJSON();
  afficherBilanHydrique();
});

// Changement type de toiture
document.getElementById('typeToiture').addEventListener('change', function() {
  afficherBilanHydrique();
});
</script>

</body>
</html>
