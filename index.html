<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bilan hydrique toitures v√©g√©talis√©es - Paris</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    body {
      display: flex;
      flex-direction: row;
    }
    #map {
      flex: 1;
      height: 100%;
      position: relative;
    }
    .info {
      width: 35vw; /* 1/3 environ */
      height: 100%;
      background: #f8f9fa; /* fond clair */
      padding: 20px;
      box-shadow: -2px 0 8px rgba(0,0,0,0.4);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      border-left: 2px solid #dee2e6;
      overflow-y: auto;
      box-sizing: border-box;
      border-radius: 0 10px 10px 0;
    }
    .info h2 {
      margin-top: 0;
      margin-bottom:10px;
      font-size: 2.1em;
      color: #28a745;
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .info label {
      font-weight: 600;
      color: #495057;
    }
    .info select {
      width: 100%;
      margin-top: 10px;
      margin-bottom: 15px;
      padding: 6px 8px;
      border: 1px solid #ced4da;
      border-radius: 5px;
      font-size: 0.95em;
      background: #ffffff;
      color: #495057;
    }
    #result {
      line-height: 1.5;
      color: #495057;
      margin-bottom:  40px;
    }
    #result b {
      color: #212529;
    }


    #toitureImage {
      width: 100%;
      border-radius: 8px;
      margin-top: 10px;
      margin-bottom: 30px;
      height: auto;       /* conserve les proportions */
    }













.section-toiture h3 {
  margin-top: 0;
  font-size: 1.2em;
  color: #28a745;
}

.section-toiture p {
  margin: 0;
}



h3 {
  margin-top: 0;
  font-size: 1.5em;
  color: #28a745;
}




#sectionExtensive {
  line-height: 1.2; /* r√©duit l'espacement entre les lignes (par d√©faut souvent ~1.5) */
  margin-top: 15px;

}
#sectionintensive {
  line-height: 1.2; /* r√©duit l'espacement entre les lignes (par d√©faut souvent ~1.5) */
  margin-top: 15px;
}


















#loadingOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.7);
  display: none; /* cach√© au d√©part */
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.loader {
  border: 10px solid #f3f3f3;
  border-top: 10px solid #28a745;
  border-radius: 50%;
  width: 70px;
  height: 70px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}















  </style>
</head>
<body>

<div id="map"></div>
<div class="info" id="info">
  <h2>Evaluez votre projet de toiture v√©g√©tale</h2>
  <label for="typeToiture"><b>Type de toiture v√©g√©talis√©e :</b></label>
  <select id="typeToiture">
    <option value="extensive" >Extensive</option>
    <option value="intensive" selected>Intensive</option>
  </select>
  <img id="toitureImage" src="" alt="Image de toiture">
  <h3 id="bilan-hydrique">Bilan hydrique de la toiture</h3>
  <div id="result">Dessinez un polygone pour calculer le bilan hydrique.</div>


<div id="sectionExtensive">
  <h3>Toiture v√©g√©talis√©e extensive</h3>
  <p><b>Poids :</b> l√©ger, environ 60 √† 150 kg/m¬≤.</p>
  <p><b>Entretien :</b> faible √† tr√®s faible.</p>
  <p><b>Type de v√©g√©tation :</b> plantes r√©sistantes, souvent sedums, mousses, gramin√©es, qui demandent peu de nutriments et peuvent survivre avec la pluie.</p>
  <p><b>Accessibilit√© :</b> rarement pi√©tonne, usage limit√©.</p>

  <p><b>Objectif principal :</b></p>
  <ul>
    <li>Isolation thermique et acoustique</li>
    <li>Gestion des eaux pluviales</li>
    <li>Am√©lioration de la biodiversit√©</li>
    <li>Effet esth√©tique discret</li>
  </ul>

  <p><b>Avantages :</b></p>
  <ul>
    <li>L√©ger, facile √† installer</li>
    <li>Co√ªt relativement faible</li>
  </ul>

  <p><b>Inconv√©nients :</b></p>
  <ul>
    <li>V√©g√©tation moins vari√©e</li>
    <li>Non adapt√©e aux espaces de loisirs</li>
  </ul>
</div>

<div id="sectionIntensive" >
  <h3>Toiture v√©g√©talis√©e intensive</h3>
  <p><b>Poids :</b> lourd, environ 200 √† 500 kg/m¬≤ (peut n√©cessiter un renforcement de la structure).</p>
  <p><b>Entretien :</b> r√©gulier (arrosage, d√©sherbage, taille).</p>
  <p><b>Type de v√©g√©tation :</b> tr√®s vari√©e : arbustes, petits arbres, pelouses, potagers.</p>
  <p><b>Accessibilit√© :</b> g√©n√©ralement pi√©tonne et am√©nageable pour des jardins ou terrasses.</p>

  <p><b>Objectif principal :</b></p>
  <ul>
    <li>Cr√©er un espace vert utilisable</li>
    <li>Isolation thermique et acoustique plus performante</li>
    <li>Gestion des eaux pluviales</li>
  </ul>

  <p><b>Avantages :</b></p>
  <ul>
    <li>Grande biodiversit√© et esth√©tisme</li>
    <li>Possibilit√© d‚Äôam√©nagements fonctionnels</li>
  </ul>

  <p><b>Inconv√©nients :</b></p>
  <ul>
    <li>Poids important ‚Üí n√©cessite renfort de structure</li>
    <li>Co√ªt et entretien √©lev√©s</li>
  </ul>

</div>

</div>




<div id="loadingOverlay">
  <div class="loader"></div>
</div>





<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<script>
const map = L.map('map').setView([48.8566, 2.3522], 19);

// Fond satellite Esri
const tiles = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, Maxar, Earthstar Geographics',
    maxZoom: 60
}).addTo(map);

// Filtrage visuel
tiles.getContainer().style.filter = 'brightness(90%) contrast(80%) saturate(90%)';

// FeatureGroup
const drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

let dernierPolygone = null;


//-----------------------------------------
// üîµ ANIMATION DE CHARGEMENT
//-----------------------------------------
function showLoader() {
  document.getElementById('loadingOverlay').style.display = "flex";
}

function hideLoader() {
  document.getElementById('loadingOverlay').style.display = "none";
}



//-----------------------------------------
// üîµ CONTR√îLE DE DESSIN
//-----------------------------------------

let drawControl = new L.Control.Draw({
  edit: false,
  draw: {
    polygon: {
      allowIntersection: false,
      showArea: true,
      shapeOptions: {
        color: 'red',
        weight: 3,
        opacity: 0.9,
        fillColor: 'red',
        fillOpacity: 0.4,
        dashArray: '4,4'
      },
      metric: true,
      repeatMode: false
    },
    polyline: false,
    rectangle: false,
    circle: false,
    marker: false,
    circlemarker: false
  }
});

map.addControl(drawControl);



//-----------------------------------------
// üîµ PREMI√àRE CR√âATION DE POLYGONE
//-----------------------------------------
map.on(L.Draw.Event.CREATED, function (e) {

  showLoader(); // affiche l'animation

  const layer = e.layer;
  drawnItems.addLayer(layer);
  dernierPolygone = layer.toGeoJSON();
  afficherBilanHydrique();

  // Remplace le contr√¥le par un avec √©dition activ√©e
  map.removeControl(drawControl);
  drawControl = new L.Control.Draw({
    edit: { featureGroup: drawnItems },
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
        shapeOptions: {
          color: 'red',
          weight: 3,
          opacity: 0.9,
          fillColor: 'red',
          fillOpacity: 0.4,
          dashArray: '4,4'
        },
        metric: true,
        repeatMode: false
      },
      polyline: false,
      rectangle: false,
      circle: false,
      marker: false,
      circlemarker: false
    }
  });

  map.addControl(drawControl);

  // Scroll automatique
  document.getElementById('info').scrollTo({
    top: document.getElementById('bilan-hydrique').offsetTop,
    behavior: 'smooth'
  });

  setTimeout(() => hideLoader(), 600); // retire l'animation
});



//-----------------------------------------
// üîµ FONCTION CALCUL BILAN HYDRIQUE
//-----------------------------------------

function calculerBilanParis(polygonGeoJSON, typeToiture='extensive') {

  const area = turf.area(polygonGeoJSON);

  const P = 634;
  const ETp = 890.5;

  let Cr = 0.25, Kc = 0.6;

  if (typeToiture === 'intensive') { 
    Cr = 0.5; 
    Kc = 0.9; 
  }

  const V_pluie = P * area * 1e-3;
  const V_retenu = P * Cr * area * 1e-3;
  const ET = ETp * Kc * area * 1e-3;
  const V_ruiss = Math.max(V_pluie - V_retenu - ET, 0);

  return { area, V_pluie, V_retenu, ET, V_ruiss };
}



//-----------------------------------------
// üîµ AFFICHAGE DU BILAN + IMAGES
//-----------------------------------------

function afficherBilanHydrique() {

  const typeToiture = document.getElementById('typeToiture').value;

  if (dernierPolygone) {
    const bilan = calculerBilanParis(dernierPolygone, typeToiture);
    document.getElementById('result').innerHTML =
      `<b>Type de toiture :</b> ${typeToiture}<br>` +
      `<b>Surface :</b> ${bilan.area.toFixed(1)} m¬≤<br>` +
      `<b>Volume total de pluie :</b> ${bilan.V_pluie.toFixed(2)} m¬≥/an<br>` +
      `<b>Volume retenu :</b> ${bilan.V_retenu.toFixed(2)} m¬≥/an<br>` +
      `<b>√âvapotranspiration :</b> ${bilan.ET.toFixed(2)} m¬≥/an<br>` +
      `<b>Volume ruissel√© :</b> ${bilan.V_ruiss.toFixed(2)} m¬≥/an`;
  }

  const img = document.getElementById('toitureImage');

  if (typeToiture === 'extensive') {
    img.src = 'https://www.toit-vegetalise.fr/wp-content/uploads/2024/11/TOUNDRA-TOITURE-VEGETALISE-3.jpg';
  } else {
    img.src = 'https://www.snpn.com/wp-content/uploads/2022/12/photo_hor_RESTREINT-CLN_toit-vegetal-Paris_MBarra.jpg';
  }

  img.style.display = 'block';

  document.getElementById('sectionExtensive').style.display =
    typeToiture === 'extensive' ? 'block' : 'none';

  document.getElementById('sectionIntensive').style.display =
    typeToiture === 'intensive' ? 'block' : 'none';
}



//-----------------------------------------
// üîµ √Ä L‚ÄôOUVERTURE DE LA PAGE
//-----------------------------------------
window.addEventListener('DOMContentLoaded', afficherBilanHydrique);


//-----------------------------------------
// üîµ CHANGEMENT TYPE DE TOITURE
//-----------------------------------------
document.getElementById('typeToiture').addEventListener('change', afficherBilanHydrique);
</script>

</body>
</html>

</html>



